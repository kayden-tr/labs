groups:
- name: ansible managed alert rules
  rules:
   - alert: InstanceDown
     expr: "up == 0"
     for: 5m
     labels:
       severity: critical
     annotations:
       description: "{% raw %}{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.{% endraw %}"
       summary: "{% raw %}Instance {{ $labels.instance }} down{% endraw %}"
   - alert: CriticalCPULoad
     labels:
       severity: critical
     annotations:
       description: '{{ $labels.instance }} of job {{ $labels.job }} has Critical CPU
         load for more than 2 minutes.'
       summary: Instance {{ $labels.instance }} - Critical CPU load
     expr: 100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m]))  * 100) > 96
     for: 2m
   - alert: CriticalRAMUsage
     labels:
       severity: critical
     annotations:
       description: '{{ $labels.instance }} has Critical Memory Usage more than 5 minutes.'
       summary: Instance {{ $labels.instance }} has Critical Memory Usage
     expr: (1 - ((node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)
       / node_memory_MemTotal_bytes)) * 100 > 98
     for: 5m
   - alert: CriticalDiskSpace
     labels:
       severity: critical
     annotations:
       description: '{{ $labels.instance }} of job {{ $labels.job }} has less than 10%
         space remaining.'
       summary: Instance {{ $labels.instance }} - Critical disk space usage
     expr: node_filesystem_free_bytes{filesystem!~"^/run(/|$)"} / node_filesystem_size_bytes < 0.1
     for: 5m
   - alert: RebootRequired
     labels:
       severity: warning
     annotations:
       description: '{{ $labels.instance }} requires a reboot.'
     expr: node_reboot_required > 0
